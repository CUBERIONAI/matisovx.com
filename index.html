<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Matisov X — Cyber Samurai</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

:root{
  --neon:#00d2ff;
  --bg:#02040a;
}

*{
  -webkit-tap-highlight-color: transparent;
  user-select: none;
  touch-action: manipulation;
}

body{
  margin:0;
  background:radial-gradient(circle at 50% 30%, #0b2a44, var(--bg));
  color:#fff;
  font-family:'Orbitron',sans-serif;
  overflow:hidden;
}

.viewport{position:relative;height:60vh;overflow:hidden;}
.cyber-floor{
  position:absolute;bottom:-60%;left:-50%;
  width:200%;height:200%;
  background:
    linear-gradient(var(--neon) 1px, transparent 1px),
    linear-gradient(90deg,var(--neon) 1px, transparent 1px);
  background-size:80px 80px;
  opacity:.15;transform:rotateX(70deg);
}
.hero-wrap{
  position:absolute;bottom:6%;left:50%;
  transform:translateX(-50%);
  filter:drop-shadow(0 0 40px var(--neon));
  transition: transform 0.05s;
}
.hero-wrap:active { transform: translateX(-50%) scale(0.95); }

#hero{height:52vh;animation:idle 3s ease-in-out infinite;}
@keyframes idle{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}

.tap-text{
  position:absolute;font-size:2.2rem;font-weight:900;
  color:var(--neon);pointer-events:none;
  animation:float .6s forwards;
  z-index: 100;
}
@keyframes float{to{transform:translateY(-180px) scale(1.4);opacity:0}}

#upgradeMenu{
  position:fixed;inset:0;background:rgba(0,0,0,0.85);
  backdrop-filter: blur(10px); z-index:50;
  display:none;justify-content:center;align-items:center;
}
.upgrade-panel{
  background:#0b1a2a;border: 1px solid var(--neon); border-radius:2rem;
  width:90%;max-width:520px;padding:2rem;
}
.upgrade-card{
  background:#05111f;padding:1rem;
  border-radius:1.5rem;
  display:flex;justify-content:space-between;
  align-items:center;
  margin-bottom:1rem;
}
.upgrade-card button{
  background:var(--neon);color:black;
  font-weight:bold;border-radius:1rem;
  padding:0.6rem 1.2rem;
}
.upgrade-card button:disabled { opacity: 0.3; }

.task{
  border:1px dashed #00d2ff;
  padding:0.7rem;
  border-radius:1rem;
  margin-bottom:0.6rem;
  font-size:0.8rem;
}
</style>
</head>
<body>

<header class="p-6 flex justify-between items-center">
  <div onclick="upgradeMenu.style.display='flex'">
    <h1 class="text-2xl font-black text-cyan-400 cursor-pointer">Matisov X</h1>
    <span class="text-[10px] bg-cyan-900 px-2 py-0.5 rounded text-cyan-300">MENU</span>
  </div>
  <div class="text-right">
    <div class="text-xs text-blue-400 uppercase">Balance</div>
    <div class="text-3xl font-black">
      <span id="balDisplay">0</span>
    </div>
  </div>
</header>

<main class="viewport" id="tapZone">
  <div class="cyber-floor"></div>
  <div class="hero-wrap">
    <img id="hero" src="https://raw.githubusercontent.com/CUBERIONAI/Matisov-X/main/file_0000000008b471f48ebdb6f35b1b1a5a.png">
  </div>
</main>

<div class="px-6 -mt-10">
  <div class="bg-black/60 rounded-3xl p-5 border border-white/5">
    <div class="flex justify-between text-xs mb-2">
      <span class="flex items-center gap-1">⚡ Energy</span>
      <span id="energyText">0 / 0</span>
    </div>
    <div class="h-3 bg-black rounded-full overflow-hidden">
      <div id="energyBar" class="h-full bg-cyan-400 transition-all duration-300"></div>
    </div>
  </div>
</div>

<div id="upgradeMenu">
  <div class="upgrade-panel">
    <h2 class="text-center text-cyan-400 text-2xl mb-4 font-black">CYBER UPGRADES</h2>

    <div class="upgrade-card">
      <div>
        <strong class="block">Cyber Hands</strong>
        <span id="handsLevel" class="text-xs text-cyan-300"></span>
        <p class="text-[10px] opacity-60">+50 Max Energy</p>
      </div>
      <button id="handsBtn">Upgrade</button>
    </div>

    <div class="upgrade-card">
      <div>
        <strong class="block">Sword Power</strong>
        <span id="swordLevel" class="text-xs text-cyan-300"></span>
        <p class="text-[10px] opacity-60">+1 MX per tap</p>
      </div>
      <button id="swordBtn">Upgrade</button>
    </div>

    <button onclick="upgradeMenu.style.display='none'" class="mt-4 w-full bg-red-500/20 text-red-500 border border-red-500/50 rounded-xl py-3 font-bold">Back to Battle</button>
  </div>
</div>

<script>
const TG = Telegram.WebApp;
TG.expand();
TG.enableClosingConfirmation();

const UID = TG.initDataUnsafe?.user?.id || "guest";

const KEY = {
  bal: `mx_bal_${UID}`,
  hands: `mx_hnd_${UID}`,
  sword: `mx_swd_${UID}`,
  energy: `mx_ene_${UID}`
};

// Конфігурація цін
const BASE_COST = 1000; 

let state = {
  bal: parseFloat(localStorage.getItem(KEY.bal)) || 0,
  hands: parseInt(localStorage.getItem(KEY.hands)) || 0,
  sword: parseInt(localStorage.getItem(KEY.sword)) || 0,
  e: parseInt(localStorage.getItem(KEY.energy)) || 1000
};

// Розрахунок характеристик
const getMaxEnergy = () => 1000 + (state.hands * 50);
const getTapPower = () => 1 + state.sword;
const getUpgradeCost = (level) => Math.floor(BASE_COST * Math.pow(1.6, level));

function handleTap(x, y) {
  const maxE = getMaxEnergy();
  if(state.e <= 0) {
    TG.HapticFeedback.notificationOccurred('error');
    return;
  }

  state.e--;
  const gain = getTapPower();
  state.bal += gain;

  // Візуал тапа
  const txt = document.createElement("div");
  txt.className = "tap-text";
  txt.style.left = x + "px";
  txt.style.top = y + "px";
  txt.textContent = `+${gain}`;
  document.body.appendChild(txt);
  setTimeout(() => txt.remove(), 600);

  // Вібрація
  TG.HapticFeedback.impactOccurred('light');
  
  render();
}

// Подія тапа (мультитач)
tapZone.addEventListener("touchstart", (e) => {
  e.preventDefault();
  Array.from(e.changedTouches).forEach(t => handleTap(t.clientX, t.clientY));
}, {passive: false});

// Кнопки покращення
handsBtn.onclick = () => buyUpgrade('hands');
swordBtn.onclick = () => buyUpgrade('sword');

function buyUpgrade(type) {
  const cost = getUpgradeCost(state[type]);
  if(state.bal >= cost) {
    state.bal -= cost;
    state[type]++;
    TG.HapticFeedback.notificationOccurred('success');
    save();
    render();
  }
}

function save() {
  localStorage.setItem(KEY.bal, state.bal);
  localStorage.setItem(KEY.hands, state.hands);
  localStorage.setItem(KEY.sword, state.sword);
  localStorage.setItem(KEY.energy, state.e);
}

function render() {
  const maxE = getMaxEnergy();
  balDisplay.textContent = Math.floor(state.bal).toLocaleString();
  energyText.textContent = `${state.e} / ${maxE}`;
  energyBar.style.width = (state.e / maxE * 100) + "%";
  
  // Кнопки
  const hCost = getUpgradeCost(state.hands);
  handsLevel.textContent = `LVL ${state.hands} • ${hCost.toLocaleString()} MX`;
  handsBtn.disabled = state.bal < hCost;

  const sCost = getUpgradeCost(state.sword);
  swordLevel.textContent = `LVL ${state.sword} • ${sCost.toLocaleString()} MX`;
  swordBtn.disabled = state.bal < sCost;
}

// Регенерація та авто-сейв
setInterval(() => {
  const maxE = getMaxEnergy();
  if(state.e < maxE) {
    state.e = Math.min(maxE, state.e + 2);
    render();
  }
  save();
}, 2000);

render();
</script>

</body>
  </html>
  
